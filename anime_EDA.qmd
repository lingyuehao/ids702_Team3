---
title: "Anime EDA"
author: "Shelly"
format: pdf
editor: visual
---

#### Load Packages

```{r load-packages, message = FALSE, warning = FALSE}
library(tidyverse)
```

# Dataset Anime

**Data source:** TOP 1050 anime info was scraped from the MAL website in October 2025: <https://www.kaggle.com/datasets/alexeiluchian/mal-anime-dataset>

**Brief description:** Each observation represents an anime title (e.g., Attack on Titan) with its average viewer score, genre list, total episodes, brief synopsis, popularity rank, total member count, producing studio(s), and release year.

**Research question 1:** How do genres and studios influence anime ratings?

-   Outcome variable (include the name/description and type of variable):

    Name: score

    -   score represents the average viewer rating given to each anime. It reflects overall audience satisfaction and quality perception on a continuous scale from 0 to 10.

    -   It is influenced by characteristics such as the genre (e.g., action, romance, comedy) and studio (e.g., MAPPA, Kyoto Animation) responsible for production.

    Type of variable: Continuous (numeric)

**Research question 2:** Is there a relationship between the number of episodes and viewer engagement?

-   Outcome variable (include the name/description and type of variable):

    Name: members

    -   members represents the total number of users who have added or interacted with an anime on the platform.

    -   It serves as a measure of viewer engagement — higher values indicate that more people are watching, following, or interested in the anime.

    Type of variable: Continuous (numeric)

**Load the data and provide a `glimpse()`**:

```{r}
library(tidyverse)
```

```{r data-1, warning=FALSE}

anime <- read.csv("https://github.com/lingyuehao/ids702_Team3/raw/refs/heads/main/anime_dataset.csv")

glimpse(anime)

```

```{r, eval=FALSE}
# Summary statistics
summary(anime)

# Check missing values
colSums(is.na(anime))

```

```{r}
# Remove the 'synopsis' column
anime <- anime %>%
  select(-synopsis)

# Separate genre & Studio
anime_clean <- anime %>%
  mutate(genres = str_remove_all(genres, "\\[|\\]|'")) %>%  
  separate_rows(genres, sep = ",\\s*") %>%
  filter(!is.na(genres) & genres != "")

anime_clean <- anime_clean %>%
mutate(studios = str_remove_all(studios, "\\[|\\]|'")) %>%  
  separate_rows(studios, sep = ",\\s*") %>%
  filter(!is.na(studios) & studios != "")

```

**Exploratory Plots:**

```{r, echo=FALSE}
genre_summary <- anime_clean %>%
  group_by(genres) %>%
  summarise(
    avg_score = mean(score, na.rm = TRUE),
    n = n(),
    .groups = "drop"
  )

top10_genre <- genre_summary %>%
  slice_max(avg_score, n = 10) %>%
  mutate(
    rank = dense_rank(desc(avg_score)),
    highlight = if_else(rank <= 3, "Top 3", "Other")
  ) %>%
  arrange(avg_score)

ggplot(top10_genre, aes(x = reorder(genres, avg_score), y = avg_score, fill = highlight)) +
  geom_col(width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", avg_score), color = highlight),
            hjust = -0.1, size = 3.8, show.legend = FALSE) +
  coord_flip(ylim = c(6, max(top10_genre$avg_score) + 0.4)) + 
  scale_fill_manual(values = c("Top 3" = "#d62728", "Other" = "#4c78a8")) +
  scale_color_manual(values = c("Top 3" = "#d62728", "Other" = "#1b2838")) +
  labs(title = "Top 10 Genres by Average Score",
       subtitle = "Scores shown on bars; Top 3 highlighted in red",
       x = "Genre", y = "Average Score") +
  theme_minimal(base_size = 13) +
  theme(legend.position = "none",
        panel.grid.major.y = element_blank(),
        plot.margin = margin(10, 30, 10, 10))

```

```{r, echo=FALSE}

studio_summary <- anime_clean %>%
  group_by(studios) %>%
  summarise(
    avg_score = mean(score, na.rm = TRUE),
    n = n(),
    .groups = "drop"
  ) 
  
top10_studios <- studio_summary %>%
  arrange(desc(avg_score), desc(n), studios) %>%  
  slice_head(n = 10) %>%                         
  mutate(
    highlight = if_else(row_number() <= 3, "Top 3", "Other")
  ) %>%
  arrange(avg_score)


ggplot(top10_studios, aes(x = reorder(studios, avg_score), y = avg_score, fill = highlight)) +
  geom_col(width = 0.7) +
  geom_text(aes(label = sprintf("%.2f", avg_score), color = highlight),
            hjust = -0.1, size = 3.8, show.legend = FALSE) +
  coord_flip(ylim = c(6, max(top10_studios$avg_score) + 0.4)) +
  scale_fill_manual(values = c("Top 3" = "#d62728", "Other" = "#4c78a8")) +
  scale_color_manual(values = c("Top 3" = "#d62728", "Other" = "#1b2838")) +
  labs(title = "Top 10 Studios by Average Score",
       subtitle = "Scores shown on bars; Top 3 highlighted in red",
       x = "Studio", y = "Average Score") +
  theme_minimal(base_size = 13) +
  theme(legend.position = "none",
        panel.grid.major.y = element_blank(),
        plot.margin = margin(10, 30, 10, 10))
```

```{r, echo=FALSE}
# Relationship between Episodes and Members
anime %>%
  filter(!is.na(episodes)) %>%
  mutate(ep_bin = cut(
    episodes,
    breaks = c(0, 12, 24, 50, 100, 200, 500, Inf),
    labels = c("≤12", "13–24", "25–50", "51–100", "101–200", "201–500", "500+"),
    right = TRUE, include.lowest = TRUE
  )) %>%
  group_by(ep_bin) %>%
  summarise(avg_members = mean(members, na.rm = TRUE), n = n(), .groups = "drop") %>%
  ggplot(aes(x = ep_bin, y = avg_members)) +
  scale_y_continuous(labels = scales::label_number(scale_cut = scales::cut_short_scale())) +
  geom_col(fill = "#4c78a8", width = 0.7) +
  geom_text(aes(label = scales::label_number(scale_cut = scales::cut_short_scale())(avg_members)),
            vjust = 1.2, color = "white", size = 3.5) +
  labs(
    title = "Average Members by Episode Range",
    x = "Episode Range", y = "Average Members"
  ) +
  theme_minimal(base_size = 13) +
  theme(panel.grid.major.x = element_blank())
```
